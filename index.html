<html>
<header>
    <title>InglÃªs para Brasileiros</title>
</header>

<body ng-app="ipb">
    <div ng-controller="MainController">
        <div ng-view></div>
        <p>{{ test }}</p>
        <img ng-src="{{ userLoggedPic }}" style="height: 100px; width: 100px;"></img>
        <p></p>
        <button fb-login type="button">facebook Login</button>
        <button g-login type="button">google Login</button>
    </div>
    <script src="node_modules/angular/angular.min.js"></script>
    <script src="node_modules/angularjs-social-login/angularjs-social-login.js"></script>

    <script>
        var ipb = angular.module('ipb', ['socialLogin']);
        ipb.controller('MainController', ['$scope', '$rootScope', '$http', function($scope, $rootScope, $http) {
            
            var socialLoginEndpoint = "https://script.google.com/macros/s/AKfycbx2XOy1foZQM0CBR9Vh-V7DReD6IkfWZf3efxoaer3igEwnnA8/exec?";
            var action = 'login';
            
            
            $scope.test = "Test...";
            $scope.userLoggedPic = 'https://www.servewell.com/assets/rodney-vieira-8e05e36ef5f243d5afe59fd023f094331a9ee730ea1f1838d015b15ef0a14cab.png';
            $rootScope.$on('event:social-sign-in-success', function(event, userDetails){
                console.log(userDetails);
                console.log(event);
                
                var completeUrl = socialLoginEndpoint+
                    'action='+action+
                    '&email='+userDetails.email+
                    '&name='+userDetails.name+
                    '&token='+userDetails.token+
                    '&provider='+userDetails.provider;
                
                $http({
                  method: 'GET',
                  url: completeUrl
                }).then(function successCallback(response) {
                    $scope.test = 'Thank you '+userDetails.name+' for logging in!';
                    if(userDetails.provider === 'facebook'){
                        $scope.userLoggedPic = 'http://graph.facebook.com/'+userDetails.uid+'/picture?type=normal';
                    } else {
                        $scope.userLoggedPic = userDetails.imageUrl;
                    }
                  }, function errorCallback(response) {
                    $scope.test = 'Failed';
                  });
                

            });
            
        }]);
        ipb.config(function(socialProvider) {
            socialProvider.setGoogleKey("1050761755996-3qjs152iqdiiga920sle88gc8jl54gcc.apps.googleusercontent.com");
            //socialProvider.setLinkedInKey("YOUR LINKEDIN CLIENT ID");
            socialProvider.setFbKey({
                appId: "1402554066740426",
                apiVersion: "v3.0"
            });
        });
        
    </script>
</body>

</html>
